---
title: "p8105_hw2_ao2965"
author: "Alissa Shams Orchi"
date: "2025-09-30"
output: github_document
---
##Question 2
Importing Trashwheel and modifying Mr.Trash Wheel sheet

```{r, message=FALSE}
library(tidyverse)
library(readxl)
trash_df <- read_excel(
 "202509 Trash Wheel Collection Data.xlsx",
 sheet = "Mr. Trash Wheel",
 range = "A2:N709",
 na = c("NA", ".", "")
) |>
 janitor::clean_names() |>
 mutate(
 table = "mr.trash wheel", 
 sports_balls = as.integer(round(sports_balls)),
 year = as.numeric(year)
) |>
 select (dumpster, month, year, date, table, everything())
```

Importing Trashwheel and modifying Professor Trash Wheel sheet

```{r, message=FALSE}
library(tidyverse)
library(readxl)
proff_df <- read_excel(
 "202509 Trash Wheel Collection Data.xlsx",
 sheet = "Professor Trash Wheel",
 range = "A2:M134",
 na = c("NA", ".", "")
) |>
 janitor::clean_names() |>
 mutate(
 table = "professor trash wheel"
 ) |>
select (dumpster, month, year, date, table, everything())
```
Importing Trashwheel and modifying Gwynns Falls Trash Wheel sheet
```{r, message=FALSE}
library(tidyverse)
library(readxl)
gwynns_df <- read_excel(
 "202509 Trash Wheel Collection Data.xlsx",
 sheet = "Gwynns Falls Trash Wheel",
 range = "A2:L351",
 na = c("NA", ".", "")
) |>
 janitor::clean_names() |>
 mutate(
 table = "gwynns falls trash wheel"
 ) |>
select (dumpster, month, year, date, table, everything())
```

Combining the tables
```{r}
trash_tidy=
  bind_rows(trash_df, proff_df, gwynns_df)
```
The combined Trash Wheel dataset includes `r nrow(trash_tidy)` observations across the three trash wheels (Mr. Trash Wheel, Professor Trash Wheel, and Gwynns Falls Trash Wheel). 
Each row corresponds to a dumpster load of trash, with key variables such as the date of collection (`date`), the total weight in tons (`weight_tons`), and counts of specific items like plastic bottles (`plastic_bottles`), cigarette butts (`cigarette_butts`), and sports balls (`sports_balls`). 
For example, the total weight of trash collected by **Professor Trash Wheel** is `r proff_df |> summarise(total = sum(weight_tons, na.rm = TRUE)) |> pull(total)` tons.

In contrast, **Gwynns Falls Trash Wheel** collected `r gwynns_df |> filter(month == "June", year == 2022) |> summarise(total = sum(cigarette_butts, na.rm = TRUE)) |> pull(total)|>format(scientific=FALSE)` cigarette butts in June 2022 alone. These summaries highlight both the scale of debris removed and the variation in composition across trash wheels and time.

##Question 3

Importing Zip codes csv
```{r, message=FALSE}
library(tidyverse)
zips_df=
  read_csv("Zip Codes.csv", na = c("NA", ".", ""))|>
 janitor::clean_names() |>
mutate(
  case_match(county,
     "New York" ~ "Manhattan", .default = county),
  county = if_else(zip_code == "11693", "Queens", county), 
           county = if_else(zip_code == "11201", "Kings", county),
    zip_code = as.character(zip_code),
    county   = county |> stringr::str_to_lower() |> gsub("county", "", x = _) |> stringr::str_squish(),
    )|> 
select(county, zip_code, neighborhood, everything())|>
  arrange(zip_code, county, neighborhood) |>
  distinct(zip_code, .keep_all = TRUE)|>
relocate (zip_code, county)
```
Importing Zip zori csv
```{r , message=FALSE} 
library(tidyverse)
zori_df=
 read_csv("Zip_zori_uc_sfrcondomfr_sm_month_NYC.csv", na = c("NA", ".", ""))|>
 janitor::clean_names() |>
select (-region_type, -state_name, -state,-city)|>
  rename(zip_code=region_name,county=county_name)|>
  pivot_longer(
    cols=x2015_01_31:x2024_08_31,
    names_to="date",
    values_to="price"
  )|>
 mutate (
    county = str_to_lower(county),       
    county = gsub("county", "", county), 
    date = gsub("x","", date),
     zip_code = as.character(zip_code),
      date   = as.Date(sub("^x", "", date), format = "%Y_%m_%d"),
    county = str_squish(county),
    price= as.numeric(price)  
  ) 
```

combine the two datasets using leftjoin
```{r}
 zorizip_tidy <- 
  left_join(
     zori_df,
     zips_df,
     by = c("zip_code", "county")          
   ) |>
   relocate(zip_code, county, neighborhood, price, date)
```

The zorizip_tidy dataset, we can track rent trends over time within each zipcode, county and neighbourhood. The combined zorizip_tidy dataset includes `r nrow(zorizip_tidy)` observations. Each row corresponds to a particular ZIP code at a specific date, with key variables including the observed rent index (`price`), geographic identifiers (e.g. `zip_code`, `county`, `neighborhood`), and data such as the `file_date` of the ZIP metadata. The number of unique ZIP codes is `r zorizip_tidy |> distinct(zip_code) |> nrow()`,and there are
`r zorizip_tidy |> mutate(neighborhood = stringr::str_squish(stringr::str_to_lower(neighborhood))) |> filter(!is.na(neighborhood), neighborhood != "") |> distinct(neighborhood) |> nrow()`
unique neighborhoods. 
There are `r zips_df |> distinct(zip_code) |> anti_join(zori_df |> distinct(zip_code), by = "zip_code") |> nrow()` ZIP codes that appear in the ZIP data but not in the Zillow rent file; e.g., `r zips_df |> distinct(zip_code) |> anti_join(zori_df |> distinct(zip_code), by = "zip_code") |> arrange(zip_code) |> pull(zip_code) |> head(5) |> paste(collapse = ", ")`. ZIP code 10008 is essentially a PO Box / special-use ZIP. Reason why these ZIP codes might be excluded from the zillow dataset is because the ZIP code may contain financial areas or parks which may not have homes or houses to search from.

```{r}
merge_table <-
  zorizip_tidy |>
  mutate(
    year  = as.integer(year(date)),
    month = as.integer(month(date))
  ) |>
group_by(zip_code, county, neighborhood, year, month) |>
  filter(!all(is.na(price))) |>
   summarise(price = mean(price, na.rm = TRUE), .groups = "drop")|>
  pivot_wider(
    id_cols = c(zip_code, county, neighborhood, month),  
    names_from = year,                                      
    values_from = price,
    names_sort = TRUE
  )|>
filter(month == 1) |>
  mutate(price_diff = `2021` - `2020`) |>
  arrange(price_diff) |>           
arrange(price_diff) |> 
  head(10)|>
  rename(borough = county)|>
  select(zip_code, borough, neighborhood, month, `2020`, `2021`, price_diff)
```

